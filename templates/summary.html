<!DOCTYPE html>
<html>

<head>
  <title>Summary</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .github-corner:hover .octo-arm {
      animation: octocat-wave 560ms ease-in-out
    }

    @keyframes octocat-wave {

      0%,
      100% {
        transform: rotate(0)
      }

      20%,
      60% {
        transform: rotate(-25deg)
      }

      40%,
      80% {
        transform: rotate(10deg)
      }
    }

    @media (max-width:500px) {
      .github-corner:hover .octo-arm {
        animation: none
      }

      .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
      }
    }
  </style>
</head>

<body>

  <div class="flex min-h-screen flex-col bg-[#221e22] text-white gap-9">
    <a href="https://github.com/sr1k7nth/attendance" class="github-corner" aria-label="View source on GitHub"><svg
        width="80" height="80" viewBox="0 0 250 250"
        style="fill:#64CEAA; color:#221e22; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z" />
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm" />
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body" />
      </svg></a>
    <main class="flex flex-grow flex-col items-center justify-center gap-9">
      <h1 class="text-6xl text-[#c4a0f9] drop-shadow-[4px_4px_0px_black] py-9 mt-9">Attendance Summary</h1>
      <div class="rounded-xl bg-[#2a272b] p-10 hover:bg-[#302d31] drop-shadow-[6px_6px_0px_black] mt-1">
        {% if update.update_available %}
        <div class=" rounded-lg bg-yellow-500 text-black p-4 mb-6 text-center font-semibold shadow-lg">
          üöÄ A new version (v{{ update.latest_version }}) is available!
          <a href="{{ update.url }}" class="underline font-bold ml-2">Download update</a>
        </div>
        {% endif %}
        <h2 class="text-2xl text-[#c4a0f9] text-center">Summary</h2>
        <table>
          <thead>
            <tr class="text-[#ee5622] border-b border-gray-700 ">
              <th class="py-2 px-5">No.</th>
              <th class="py-2 px-5">Code</th>
              <th class="py-2 px-5">Subject</th>
              <th class="py-2 px-5">Avg Attendance</th>
              <th class="py-2 px-5">Total Classes</th>
              <th class="py-2 px-5">Attended</th>
            </tr>
          </thead>
          <tbody>
            {% for item in result[0] %}
            <tr>
              <td class="py-2 px-5">{{item.no}}</td>
              <td class="py-2 px-5">{{item.code}}</td>
              <td class="py-2 px-5">{{item.name}}</td>
              <td class="py-2 px-5">{{item.percentage}}</td>
              <td class="py-2 px-5">{{item.classes}}</td>
              <td class="py-2 px-5">{{item.present}}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <div class="rounded-xl bg-[#422528] p-10 hover:bg-[#512e31] drop-shadow-[6px_6px_0px_black] m-2">
        <h2 class="text-2xl text-[#c4a0f9] text-center">Absent Periods</h2>
        <table class="w-full text-left border-collapse">
          <thead>
            <tr class="border-b border-gray-700 text-gray-300">
              <th class="py-2 px-5">No.</th>
              <th class="py-2 px-5">Course</th>
              <th class="py-2 px-5">Date</th>
              <th class="py-2 px-5">Day</th>
            </tr>
          </thead>
          <tbody>
            {% if result[1] %}

            {% for item in result[1] %}
            <tr>
              <td class="py-2 px-5">{{ loop.index }}</td>
              <td class="py-2 px-5">{{ item.course }}</td>
              <td class="py-2 px-5">{{ item.date }}</td>
              <td class="py-2 px-5">{{ item.day }}</td>
            </tr>
            {% endfor %}

            {% else %}

            <tr>
              <td colspan="4" class="py-4 px-5 text-center text-emerald-500 text-l ">
                <i>
                  No classes missed this week!
                </i>
              </td>
            </tr>

            {% endif %}
          </tbody>
        </table>
      </div>
      <div class="flex flex-row rounded-xl bg-[#2a272b] m-2 hover:bg-[#302d31] drop-shadow-[6px_6px_0px_black] text-xl">
        <h2 class="text-3xl text-[#c4a0f9] font-bold w-32 flex items-center justify-center flex-shrink-0">75%</h2>
        {% if result[2] > 75 %}
        <p class="p-10 text-emerald-500"><strong>Total Average (75% Target):</strong> {{ result[2] }}%</p>
        {% else %}
        <p class="p-10 text-red-500"><strong>Total Average (75% Target):</strong> {{ result[2] }}%</p>
        {% endif %}

        {% if result[4] > 0 %}
        <p class="p-10 text-emerald-500"><strong>Can Miss (75%):</strong> {{ result[4] }}</p>
        {% else %}
        <p class="p-10 text-red-500"><strong>Can Miss (75%):</strong> {{ result[4] }}</p>
        {% endif %}

        {% if result[6] > 0 %}
        <p class="p-10 text-red-500"><strong>Need to Attend (75%):</strong> {{ result[6] }}</p>
        {% else %}
        <p class="p-10 text-emerald-500"><strong>Need to Attend (75%):</strong> {{ result[6] }}</p>
        {% endif %}

      </div>

      <div class="flex flex-row rounded-xl bg-[#2a272b] m-2 hover:bg-[#302d31] drop-shadow-[6px_6px_0px_black] text-xl">
        <h2 class="text-3xl text-[#c4a0f9] font-bold w-32 flex items-center justify-center flex-shrink-0">85%</h2>
        {% if result[2] > 85 %}
        <p class="p-10 text-emerald-500"><strong>Total Average(85% Target):</strong> {{ result[2] }}%</p>
        {% else %}
        <p class="p-10 text-red-500"><strong>Total Average(85% Target):</strong> {{ result[2] }}%</p>
        {% endif %}

        {% if result[3] > 0 %}
        <p class="p-10 text-emerald-500"><strong>Can Miss(85%):</strong> {{ result[3] }}</p>
        {% else %}
        <p class="p-10 text-red-500"><strong>Can Miss(85%):</strong> {{ result[3] }}</p>
        {% endif %}

        {% if result[5] > 0 %}
        <p class="p-10 text-red-500"><strong>Need to Attend(85%):</strong> {{ result[5] }}</p>
        {% else %}
        <p class="p-10 text-emerald-500"><strong>Need to Attend(85%):</strong> {{ result[5] }}</p>
        {% endif %}
      </div>

      <form onsubmit="event.preventDefault(); calculateCustom();">
        <div
          class="rounded-xl bg-[#2a272b] p-8 mt-4 w-[32rem] text-center drop-shadow-[6px_6px_0px_black] hover:bg-[#302d31]">
          <h2 class="text-2xl text-[#c4a0f9] mb-4">Custom Attendance Calculator</h2>

          <label class="text-lg">Enter Target Percentage:</label>
          <input id="targetInput" type="number" min="1" max="100"
            class="mt-2 w-full px-3 py-2 rounded bg-slate-800 border border-emerald-500 text-white"
            placeholder="e.g. 80" />

          <button type="button" onclick="calculateCustom()"
            class="mt-4 w-full rounded bg-emerald-600 py-2 text-black hover:bg-emerald-800 hover:text-white">
            Calculate
          </button>

          <div id="customResult" class="mt-4 text-xl"></div>
        </div>
      </form>


    </main>

    <footer class="py-4 text-center text-xl text-gray-300">made by <a href="https://github.com/sr1k7nth"
        class="text-[#ee5622] hover:text-[#f77a4f]">sr1k7nth</a></footer>
  </div>

  <script>
    const totalAvg = {{ result[2] | tojson }};
    const summaryData = {{ result[0] | tojson }};

    const totalPresent = summaryData.reduce((sum, item) => sum + parseInt(item.present), 0);
    const totalClasses = summaryData.reduce((sum, item) => sum + parseInt(item.classes), 0);

    function calculateCustom() {
      const target = parseFloat(document.getElementById("targetInput").value);
      const resultBox = document.getElementById("customResult");

      if (!target || target <= 0 || target > 100) {
        resultBox.innerHTML = "<p class='text-red-500'>Enter a valid percentage (1‚Äì100)</p>";
        return;
      }

      if (target > totalAvg) {
        const need = Math.ceil(
          ((target / 100 * totalClasses) - totalPresent) / (1 - target / 100)
        );

        resultBox.innerHTML = `
        <p class="text-emerald-400">
          üìò You must attend <b>${need}</b> more classes to reach <b>${target}%</b>.
        </p>`;
        return;
      }

      if (target < totalAvg) {
        const canMiss = Math.floor(
          (totalPresent - (target / 100 * totalClasses)) / (target / 100)
        );

        resultBox.innerHTML = `
        <p class="text-yellow-400">
          üçÄ You can miss <b>${canMiss}</b> classes and still maintain <b>${target}%</b>.
        </p>`;
        return;
      }

      resultBox.innerHTML = `
      <p class="text-blue-400">You're already at ${target}%.</p>`;
    }

    document.getElementById("targetInput").addEventListener("keydown", function (event) {
      if (event.key === "Enter") {
        event.preventDefault();
        calculateCustom();
      }
    });
  </script>
</body>

</html>